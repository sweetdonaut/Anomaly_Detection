# ç„¡ç›£ç£ç•°å¸¸æª¢æ¸¬ç³»çµ± (Unsupervised Anomaly Detection System)

åŸºæ–¼æ·±åº¦å­¸ç¿’è‡ªç·¨ç¢¼å™¨çš„å·¥æ¥­ç¼ºé™·æª¢æ¸¬ç³»çµ±ï¼Œå°ˆç‚ºå–®é€šé“å½±åƒè¨­è¨ˆï¼Œæ”¯æ´ç„¡æ¨™ç±¤çš„ç•°å¸¸æª¢æ¸¬ã€‚æœ¬ç³»çµ±æ¡ç”¨æ¨¡çµ„åŒ–æ¶æ§‹ï¼Œæ”¯æ´å¤šç¨®æå¤±å‡½æ•¸çµ„åˆï¼Œä¸¦æä¾›å®Œæ•´çš„è¦–è¦ºåŒ–åˆ†æå·¥å…·ã€‚

## ğŸ“‹ ç›®éŒ„

- [ç³»çµ±æ¦‚è¿°](#ç³»çµ±æ¦‚è¿°)
- [é‹ä½œæµç¨‹åœ–](#é‹ä½œæµç¨‹åœ–)
- [ä¸»è¦ç‰¹è‰²](#ä¸»è¦ç‰¹è‰²)
- [å®‰è£éœ€æ±‚](#å®‰è£éœ€æ±‚)
- [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
- [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
- [ä½¿ç”¨æ–¹å¼](#ä½¿ç”¨æ–¹å¼)
- [åƒæ•¸é…ç½®](#åƒæ•¸é…ç½®)
- [è¼¸å‡ºçµæœ](#è¼¸å‡ºçµæœ)

## ğŸ” ç³»çµ±æ¦‚è¿°

æœ¬ç³»çµ±ä½¿ç”¨è‡ªç·¨ç¢¼å™¨æ¶æ§‹é€²è¡Œç„¡ç›£ç£ç•°å¸¸æª¢æ¸¬ï¼Œåƒ…éœ€æ­£å¸¸æ¨£æœ¬é€²è¡Œè¨“ç·´ã€‚é€éåˆ†æé‡å»ºèª¤å·®å’Œæ½›åœ¨ç©ºé–“ç‰¹å¾µï¼Œèƒ½å¤ æœ‰æ•ˆæª¢æ¸¬å‡ºç•°å¸¸å€åŸŸã€‚

### ğŸ†• æœ€æ–°ç‰ˆæœ¬ (v3) ç‰¹è‰²
- **å¢å¼·çš„ SSIM Loss**ï¼šå®Œæ•´å¯¦ä½œèˆ‡è©³ç´°æ–‡æª”
- **Multi-Scale SSIM Loss**ï¼šå¤šå°ºåº¦çµæ§‹ç›¸ä¼¼æ€§åˆ†æ
- **çµ±ä¸€æå¤±å‡½æ•¸æ¶æ§‹**ï¼šæ‰€æœ‰æå¤±å‡½æ•¸ç¹¼æ‰¿è‡ª `BaseLoss`
- **å…¨è‹±æ–‡ç¨‹å¼ç¢¼**ï¼šé©åˆç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²
- **å–®é€šé“å„ªåŒ–**ï¼šå°ˆç‚ºç°éšå½±åƒè¨­è¨ˆ

## ğŸ”„ é‹ä½œæµç¨‹åœ–

### è¨“ç·´éšæ®µ (Training Phase)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         è³‡æ–™æº–å‚™éšæ®µ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ­£å¸¸åœ–ç‰‡è³‡æ–™   â”‚ â”€â”€â”€â–º â”‚    è³‡æ–™å¢å¼·      â”‚ â”€â”€â”€â–º â”‚  åˆæˆç•°å¸¸ç”Ÿæˆ    â”‚
â”‚  (976Ã—176 ç°éš)  â”‚      â”‚  â€¢ æ—‹è½‰ Â±5Â°     â”‚      â”‚  â€¢ äº®é»/æš—é»     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â€¢ ç¸®æ”¾ 95-105%  â”‚      â”‚  â€¢ 10Ã—10 åƒç´    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â€¢ å¼·åº¦ 0.2-0.4  â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ¨¡å‹è¨“ç·´éšæ®µ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                       â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Baseline AE  â”‚        â”‚ Enhanced AE  â”‚
           â”‚ (ç„¡è·³èºé€£æ¥) â”‚        â”‚ (U-Net æ¶æ§‹) â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    ç·¨ç¢¼å™¨ (Encoder)  â”‚
                    â”‚  976Ã—176 â†’ 30Ã—5     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    ç“¶é ¸å±¤           â”‚
                    â”‚  (Bottleneck)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   è§£ç¢¼å™¨ (Decoder)  â”‚
                    â”‚   30Ã—5 â†’ 976Ã—176    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æ¨¡çµ„åŒ–æå¤±å‡½æ•¸     â”‚
                    â”‚  â€¢ MSE (30%)        â”‚
                    â”‚  â€¢ SSIM (30%)       â”‚
                    â”‚  â€¢ MS-SSIM (å¯é¸)   â”‚
                    â”‚  â€¢ Focal Freq (20%)â”‚
                    â”‚  â€¢ Sobel Edge (20%)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨ç†éšæ®µ (Inference Phase)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ¨ç†éšæ®µ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    è¼¸å…¥åœ–ç‰‡         â”‚
                    â”‚  (å¯èƒ½å«ç•°å¸¸)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                       â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  é‡å»ºèª¤å·®     â”‚        â”‚ æ½›åœ¨ç©ºé–“åˆ†æ â”‚
           â”‚  è¨ˆç®—        â”‚        â”‚ (L2 è·é›¢)    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    ç•°å¸¸åˆ†æ•¸è¨ˆç®—     â”‚
                    â”‚ Score = MSE + 0.5Ã—L2â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                       â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  ç•°å¸¸ç†±åŠ›åœ–   â”‚        â”‚   è¦–è¦ºåŒ–è¼¸å‡º  â”‚
           â”‚  (Heatmap)   â”‚        â”‚  â€¢ åŸåœ–      â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â€¢ é‡å»ºåœ–    â”‚
                                   â”‚  â€¢ å·®ç•°åœ–    â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ¨ ä¸»è¦ç‰¹è‰²

### 1. **ç„¡éœ€æ¨™ç±¤è¨“ç·´**
- åƒ…ä½¿ç”¨æ­£å¸¸æ¨£æœ¬é€²è¡Œè¨“ç·´
- è‡ªå‹•å­¸ç¿’æ­£å¸¸æ¨¡å¼çš„ç‰¹å¾µè¡¨ç¤º

### 2. **é›™é‡ç¶²è·¯æ¶æ§‹**
- **Baseline Autoencoder**: æ¨™æº–æ¶æ§‹ï¼Œå¼·åˆ¶è³‡è¨Šå£“ç¸®
- **Enhanced Autoencoder**: U-Net é¢¨æ ¼ï¼Œç²¾ç¢ºç¼ºé™·å®šä½

### 3. **åˆæˆç•°å¸¸ç”Ÿæˆ**
- è¨“ç·´æ™‚è‡ªå‹•ç”Ÿæˆäº®é»/æš—é»ç¼ºé™·
- æå‡æ¨¡å‹å°ç•°å¸¸çš„æ•æ„Ÿåº¦

### 4. **æ¨¡çµ„åŒ–æå¤±å‡½æ•¸ (v3 å¢å¼·)**
- **MSE**: åƒç´ ç´šé‡å»ºç²¾åº¦
- **SSIM**: çµæ§‹ç›¸ä¼¼æ€§ä¿ç•™ï¼ˆå«è©³ç´°åƒæ•¸æ§åˆ¶ï¼‰
- **Multi-Scale SSIM**: å¤šå°ºåº¦çµæ§‹åˆ†æ
- **Focal Frequency Loss**: é »ç‡åŸŸç‰¹å¾µ
- **Sobel Gradient Loss**: é‚Šç·£è³‡è¨Šä¿ç•™
- **çµ±ä¸€ç®¡ç†**: é€é `ModularLossManager` è‡ªå‹•æ¬Šé‡æ­£è¦åŒ–

### 5. **æ™ºæ…§è³‡æºç®¡ç†**
- è‡ªå‹•åµæ¸¬ CPU æ ¸å¿ƒæ•¸
- å‹•æ…‹èª¿æ•´è³‡æ–™è¼‰å…¥å™¨çš„å·¥ä½œé€²ç¨‹æ•¸

## ğŸ“¦ å®‰è£éœ€æ±‚

```bash
# åŸºæœ¬å¥—ä»¶
pip install torch torchvision
pip install numpy pillow matplotlib
pip install tqdm scipy
pip install opencv-python  # ç”¨æ–¼åˆæˆç•°å¸¸ç”Ÿæˆ
pip install scikit-learn   # ç”¨æ–¼è©•ä¼°æŒ‡æ¨™

# å»ºè­°ä½¿ç”¨ CUDA æ”¯æ´çš„ PyTorch ç‰ˆæœ¬ä»¥åŠ é€Ÿè¨“ç·´
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118

# Python ç‰ˆæœ¬è¦æ±‚
# Python >= 3.8 (éœ€è¦ typing æ¨¡çµ„æ”¯æ´)
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. æº–å‚™è³‡æ–™
ç¢ºä¿æ‚¨çš„è³‡æ–™çµæ§‹å¦‚ä¸‹ï¼š
```
/path/to/dataset/
â”œâ”€â”€ category_name/
â”‚   â”œâ”€â”€ train/
â”‚   â”‚   â””â”€â”€ good/
â”‚   â”‚       â”œâ”€â”€ 000.png
â”‚   â”‚       â”œâ”€â”€ 001.png
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ test/
â”‚       â”œâ”€â”€ good/
â”‚       â””â”€â”€ defect_type/
```

### 2. åŸ·è¡Œè¨“ç·´
```bash
# ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ (v3)
python MVTec_unsupervised/anomaly_detection_v3.py

# ä½¿ç”¨å‰ä¸€ç‰ˆæœ¬ (v2)
python MVTec_unsupervised/anomaly_detection_v2.py
```

### 3. æŸ¥çœ‹çµæœ
è¨“ç·´å®Œæˆå¾Œï¼Œçµæœå°‡å„²å­˜åœ¨ï¼š
- æ¨¡å‹æª”æ¡ˆï¼š`./models/{category}_final_model.pth`
- è¨“ç·´æ­·å²ï¼š`./models/{category}_training_history.json`
- è¦–è¦ºåŒ–çµæœï¼š`./models/visualizations_{category}/`
- ç•°å¸¸åˆ†æ•¸ï¼š`./models/visualizations_{category}/anomaly_scores.txt`

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### ç¶²è·¯å°ºå¯¸è®ŠåŒ–
```
è¼¸å…¥: 976Ã—176 (ç°éš)
â”œâ”€â”€ ç·¨ç¢¼å™¨è·¯å¾‘:
â”‚   â”œâ”€â”€ 976Ã—176 â†’ 488Ã—88 (Conv 3Ã—3, stride 2)
â”‚   â”œâ”€â”€ 488Ã—88 â†’ 244Ã—44
â”‚   â”œâ”€â”€ 244Ã—44 â†’ 122Ã—22
â”‚   â”œâ”€â”€ 122Ã—22 â†’ 61Ã—11
â”‚   â””â”€â”€ 61Ã—11 â†’ 30Ã—5 (æœ€çµ‚ç·¨ç¢¼)
â”‚
â””â”€â”€ è§£ç¢¼å™¨è·¯å¾‘:
    â”œâ”€â”€ 30Ã—5 â†’ 61Ã—11 (ConvTranspose)
    â”œâ”€â”€ 61Ã—11 â†’ 122Ã—22
    â”œâ”€â”€ 122Ã—22 â†’ 244Ã—44
    â”œâ”€â”€ 244Ã—44 â†’ 488Ã—88
    â””â”€â”€ 488Ã—88 â†’ 976Ã—176 (è¼¸å‡º)
```

### æ¿€æ´»å‡½æ•¸
- ä½¿ç”¨ SiLU (Swish) å–ä»£å‚³çµ± ReLU
- æä¾›æ›´å¹³æ»‘çš„æ¢¯åº¦æµ
- é¿å…æ­»ç¥ç¶“å…ƒå•é¡Œ

## ğŸ’» ä½¿ç”¨æ–¹å¼

### åŸºæœ¬ä½¿ç”¨
```python
from anomaly_detection_v3 import *

# è¼‰å…¥è¨“ç·´å¥½çš„æ¨¡å‹
model = EnhancedAutoencoder()  # æˆ– BaselineAutoencoder()
model.load_state_dict(torch.load('models/grid_final_model.pth'))
model.eval()

# é€²è¡Œæ¨ç†
transform = transforms.Compose([
    transforms.Resize((976, 176)),
    transforms.ToTensor(),
    transforms.Normalize(mean=[0.5], std=[0.5])
])

# è¼‰å…¥åœ–ç‰‡
image = Image.open('test_image.png').convert('L')
image_tensor = transform(image).unsqueeze(0)

# ç”Ÿæˆç•°å¸¸ç†±åŠ›åœ–
with torch.no_grad():
    recon = model(image_tensor)
    diff = torch.abs(image_tensor - recon)
    heatmap = diff[0, 0].cpu().numpy()
    
# ä½¿ç”¨æ½›åœ¨ç©ºé–“åˆ†æï¼ˆå¯é¸ï¼‰
latent_analyzer = LatentSpaceAnalyzer(model, device='cuda')
anomaly_score = latent_analyzer.compute_anomaly_score(image_tensor)
```

### è‡ªå®šç¾©è¨“ç·´é…ç½®
```python
# ä¿®æ”¹é…ç½® (v3)
config = {
    'batch_size': 8,           # æ‰¹æ¬¡å¤§å°
    'num_epochs': 50,          # è¨“ç·´é€±æœŸ
    'lr': 5e-4,                # å­¸ç¿’ç‡
    'architecture': 'baseline', # æˆ– 'enhanced'
    'use_synthetic_anomalies': False,  # é—œé–‰åˆæˆç•°å¸¸
    'loss_config': {
        # è‡ªå®šç¾©æå¤±å‡½æ•¸çµ„åˆ
        'mse': {'class': MSELoss, 'weight': 0.4},
        'ssim': {'class': SSIMLoss, 'weight': 0.4, 'params': {'window_size': 11}},
        'sobel': {'class': SobelGradientLoss, 'weight': 0.2}
    }
}

# ä½¿ç”¨ Multi-Scale SSIM
config['loss_config'] = {
    'mse': {'class': MSELoss, 'weight': 0.3},
    'ms_ssim': {
        'class': MultiScaleSSIMLoss, 
        'weight': 0.5,
        'params': {'scales': 3, 'sigma': 1.5}
    },
    'focal_freq': {'class': FocalFrequencyLoss, 'weight': 0.2}
}
```

## âš™ï¸ åƒæ•¸é…ç½®

### ä¸»è¦é…ç½®åƒæ•¸

| åƒæ•¸ | é è¨­å€¼ | èªªæ˜ |
|------|--------|------|
| `batch_size` | 16 | è¨“ç·´æ‰¹æ¬¡å¤§å° |
| `num_epochs` | 100 | è¨“ç·´é€±æœŸæ•¸ |
| `lr` | 1e-3 | å­¸ç¿’ç‡ |
| `image_size` | (976, 176) | è¼¸å…¥å½±åƒå°ºå¯¸ |
| `architecture` | 'enhanced' | ç¶²è·¯æ¶æ§‹é¸æ“‡ |
| `use_synthetic_anomalies` | True | æ˜¯å¦ä½¿ç”¨åˆæˆç•°å¸¸ |

### æå¤±å‡½æ•¸æ¬Šé‡ (v3 æ¨¡çµ„åŒ–è¨­è¨ˆ)

| çµ„ä»¶ | é è¨­æ¬Šé‡ | åŠŸèƒ½ | åƒæ•¸ |
|------|----------|------|------|
| MSE | 0.3 | åƒç´ ç´šç²¾ç¢ºåº¦ | - |
| SSIM | 0.3 | çµæ§‹ç›¸ä¼¼æ€§ | window_size, sigma |
| Multi-Scale SSIM | - | å¤šå°ºåº¦çµæ§‹ | scales, scale_weights |
| Focal Frequency | 0.2 | é »ç‡åŸŸç‰¹å¾µ | alpha, patch_factor |
| Sobel Gradient | 0.2 | é‚Šç·£ä¿ç•™ | - |

**æ³¨æ„**: æ¬Šé‡æœƒè‡ªå‹•æ­£è¦åŒ–è‡³ç¸½å’Œç‚º 1.0

## ğŸ“Š è¼¸å‡ºçµæœ

### 1. æ¨¡å‹æª”æ¡ˆ
- `{category}_final_model.pth`: æœ€çµ‚è¨“ç·´æ¨¡å‹
- `checkpoint_epoch_{n}.pth`: æ¯ 10 å€‹ epoch çš„æª¢æŸ¥é»
- `{category}_training_history.json`: è¨“ç·´æ­·å²è¨˜éŒ„ï¼ˆv3 æ–°å¢ï¼‰

### 2. è¦–è¦ºåŒ–çµæœ
æ¯å€‹æ¸¬è©¦æ¨£æœ¬åŒ…å«ä¸‰å¼µåœ–ï¼š
- **åŸå§‹åœ–ç‰‡**: è¼¸å…¥çš„æ¸¬è©¦å½±åƒ
- **é‡å»ºåœ–ç‰‡**: æ¨¡å‹é‡å»ºçš„çµæœ
- **ç•°å¸¸ç†±åŠ›åœ–**: é¡¯ç¤ºç•°å¸¸å€åŸŸï¼ˆç´…è‰²=é«˜ç•°å¸¸åˆ†æ•¸ï¼‰

### 3. ç•°å¸¸åˆ†æ•¸çµ±è¨ˆ
- å¹³å‡ç•°å¸¸åˆ†æ•¸
- æœ€å¤§ç•°å¸¸åˆ†æ•¸
- æœ€å°ç•°å¸¸åˆ†æ•¸
- å€‹åˆ¥å½±åƒåˆ†æ•¸è¨˜éŒ„ï¼ˆå„²å­˜è‡³æ–‡å­—æª”ï¼‰

### 4. è¨“ç·´æ­·å² (v3 æ–°å¢)
```json
{
  "total_loss": [...],
  "component_losses": {
    "mse": [...],
    "ssim": [...],
    "focal_freq": [...],
    "sobel": [...]
  },
  "weights": [...]
}
```

## ğŸ”§ é€²éšåŠŸèƒ½

### 1. æ‰¹æ¬¡æ¨ç†
```python
# å°æ•´å€‹è³‡æ–™å¤¾é€²è¡Œç•°å¸¸æª¢æ¸¬
def batch_inference(model, folder_path, transform):
    results = []
    for img_path in Path(folder_path).glob('*.png'):
        # è™•ç†æ¯å¼µåœ–ç‰‡
        score = compute_anomaly_score(model, img_path, transform)
        results.append((img_path, score))
    return results
```

### 2. è‡ªå®šç¾©ç•°å¸¸é–¾å€¼
```python
# åŸºæ–¼è¨“ç·´è³‡æ–™çµ±è¨ˆè¨­å®šé–¾å€¼
normal_scores = compute_normal_scores(model, train_loader)
threshold = np.mean(normal_scores) + 3 * np.std(normal_scores)
```

## ğŸ“ æ³¨æ„äº‹é …

1. **è¨˜æ†¶é«”éœ€æ±‚**: Enhanced æ¶æ§‹éœ€è¦è¼ƒå¤š GPU è¨˜æ†¶é«”
2. **è¨“ç·´æ™‚é–“**: 100 epochs ç´„éœ€ 1-2 å°æ™‚ï¼ˆå–æ±ºæ–¼ GPUï¼‰
3. **å½±åƒæ ¼å¼**: ç³»çµ±é æœŸå–®é€šé“ç°éš PNG å½±åƒ
4. **æ­£è¦åŒ–**: å½±åƒä½¿ç”¨ mean=0.5, std=0.5 æ­£è¦åŒ–
5. **ç¨‹å¼ç¢¼èªè¨€**: v3 ç‰ˆæœ¬æ‰€æœ‰ç¨‹å¼ç¢¼è¨»è§£ä½¿ç”¨è‹±æ–‡
6. **æå¤±å‡½æ•¸**: æ‰€æœ‰æå¤±å‡½æ•¸å¿…é ˆç¹¼æ‰¿è‡ª `BaseLoss`

## ğŸš€ ç‰ˆæœ¬æ­·å²

### v3.0 (æœ€æ–°ç‰ˆæœ¬)
- âœ¨ å¢å¼· SSIM Loss å¯¦ä½œèˆ‡æ–‡æª”
- âœ¨ æ–°å¢ Multi-Scale SSIM Loss
- âœ¨ çµ±ä¸€æå¤±å‡½æ•¸æ¶æ§‹ï¼ˆBaseLossï¼‰
- âœ¨ å…¨è‹±æ–‡ç¨‹å¼ç¢¼ä»‹é¢
- âœ¨ è¨“ç·´æ­·å²è¨˜éŒ„åŠŸèƒ½
- ğŸ”§ ä¿®æ­£ FocalFrequencyLoss ç›¸å®¹æ€§

### v2.0
- âœ¨ æ¨¡çµ„åŒ–æå¤±å‡½æ•¸æ¡†æ¶
- âœ¨ é›™é‡ç¶²è·¯æ¶æ§‹æ”¯æ´
- âœ¨ åˆæˆç•°å¸¸ç”ŸæˆåŠŸèƒ½
- âœ¨ æ½›åœ¨ç©ºé–“åˆ†æ

### v1.0
- ğŸ‰ åˆå§‹ç‰ˆæœ¬ç™¼å¸ƒ
- ğŸ¯ åŸºæœ¬è‡ªç·¨ç¢¼å™¨å¯¦ä½œ

## ğŸ¤ è²¢ç»æŒ‡å—

æ­¡è¿æäº¤ Issue æˆ– Pull Request ä¾†æ”¹é€²ç³»çµ±ï¼

å»ºè­°æ”¹é€²æ–¹å‘ï¼š
- æ–°å¢æ›´å¤šæå¤±å‡½æ•¸é¸é …
- æ”¯æ´æ›´å¤šè³‡æ–™æ ¼å¼
- å¢åŠ å³æ™‚æ¨ç†ä»‹é¢
- æ”¹é€²è¦–è¦ºåŒ–åŠŸèƒ½

## ğŸ“„ æˆæ¬Š

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Šæ¢æ¬¾ã€‚